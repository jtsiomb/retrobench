src = $(wildcard src/*.c) $(wildcard src/dos/*.c)
ssrc = sinlut.s
obj = $(src:.c=.o) $(ssrc:.s=.o)
dep = $(src:.c=.d)
coff = rbench
bin = $(coff).exe
bin0 = $(coff)0.exe

LUTGEN = tools/lutgen.exe

warn = -pedantic -Wall -Wno-deprecated-declarations
dbg = -g
opt = -O3 -ffast-math
inc = -Isrc
def = -DNO_STDINT_H

CFLAGS = -pedantic $(warn) $(dbg) $(opt) $(def) $(inc) -fno-strict-aliasing -MMD
LDFLAGS = -Wl,-Map=link.map

$(bin0): $(bin)
	exe2coff $<
	copy /b \djgpp\bin\cwsdstr0.exe+$(coff) $@

$(bin): $(obj)
	$(CC) -o $@ $(obj) $(LDFLAGS)

sinlut.s: $(LUTGEN)
	$(LUTGEN) >$@

-include $(dep)
-include *.d

.PHONY: clean
clean:
	del src\*.o
	del src\dos\*.o
	del *.o
	del $(bin)
	del sinlut.s

.PHONY: cleandep
cleandep:
	del src\*.d
	del src\dos\*.d
	del *.d

$(LUTGEN): tools/lutgen.c
	$(CC) -o $@ $< -lm
